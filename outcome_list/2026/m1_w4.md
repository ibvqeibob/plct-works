# MVP PLIC PR

## 1. 具体内容

### 1.1 用 Sail runtime JSON config 
- 采用 **编译期 MAX + 运行时 active 值** 的组合：
  - **type-level MAX**：保证 Sail 的 `bits()` / `vector()` 长度仍是编译期常量（避免 type-level 卡死）
  - **runtime active**：从 JSON 读入后 clamp 到 MAX，在循环和 MMIO 行为中限制有效范围

### 1.2 priority register 从 list 改为 vector
- `plic_priority` 从 `list(bits(32))` 改为 `vector(..., bits(32))`
- 删除 list 的 init/get/set helper（或不再使用）
- 改为 vector 访问/更新

---

## 2. MVP最终实现方式

### 2.1 编译期 MAX（Sail type-level）
type plic_nsrc = 64
type plic_nctx = 2

let PLIC_NSRC_MAX = sizeof(plic_nsrc)
let PLIC_NCTX_MAX = sizeof(plic_nctx)

### 2.2 运行时 active（从 JSON 读 + clamp）
register plic_nsrc_active : int = PLIC_NSRC_MAX
register plic_nctx_active : int = PLIC_NCTX_MAX

private function clamp_int(x:int, lo:int, hi:int) -> int =
  if x < lo then lo else if x > hi then hi else x

### 2.3 在 `init_platform()` 初始化 active
在 `init_platform()` 里加入：
* `get_config_plic_nsrc()` / `get_config_plic_nctx()` 读取配置
* clamp 到 `[1..MAX]`

### 2.4 文件来源
`config/config.json.in`

```bash
./build/c_emulator/sail_riscv_sim --config build/config/rv32d_v128_e32.json
```


